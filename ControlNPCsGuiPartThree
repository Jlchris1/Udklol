-- NPC Utility GUI v4.1 (Permanent Erase + consistent size with Part1/2)
-- LocalScript, place in StarterGui

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")

-- CONFIG
local GUI_WIDTH = 280 -- same as Part1/2
local GUI_HEIGHT = 400
local TOGGLE_WIDTH = 70
local LOOP_DELAY = 0.1

-- GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "NPCUtilityGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.IgnoreGuiInset = true
ScreenGui.Parent = PlayerGui

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, GUI_WIDTH, 0, 34)
MainFrame.Position = UDim2.new(0, 10, 0, 80)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
MainFrame.BorderSizePixel = 0
MainFrame.ClipsDescendants = true
MainFrame.Parent = ScreenGui

local ToggleButton = Instance.new("TextButton")
ToggleButton.Size = UDim2.new(0, TOGGLE_WIDTH, 1, 0)
ToggleButton.Position = UDim2.new(0, 0, 0, 0)
ToggleButton.BackgroundColor3 = Color3.fromRGB(44, 44, 44)
ToggleButton.BorderSizePixel = 0
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.TextSize = 15
ToggleButton.TextColor3 = Color3.new(1, 1, 1)
ToggleButton.Text = "â˜° NPC Utility"
ToggleButton.Parent = MainFrame

local Options = Instance.new("Frame")
Options.Size = UDim2.new(1, 0, 0, GUI_HEIGHT)
Options.Position = UDim2.new(0, 0, 0, 34)
Options.BackgroundColor3 = Color3.fromRGB(32, 32, 32)
Options.BorderSizePixel = 0
Options.Visible = false
Options.Parent = MainFrame

-- UI Helpers
local function makeRow(y)
	local row = Instance.new("Frame")
	row.Size = UDim2.new(1, -12, 0, 34)
	row.Position = UDim2.new(0, 6, 0, y)
	row.BackgroundTransparency = 1
	row.Parent = Options
	return row
end

local function makeToggle(parent, text)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(1, 0, 1, 0)
	btn.BackgroundColor3 = Color3.fromRGB(58, 58, 58)
	btn.BorderSizePixel = 0
	btn.Font = Enum.Font.Gotham
	btn.TextSize = 14
	btn.TextColor3 = Color3.new(1, 1, 1)
	btn.Text = text .. " : Off"
	btn.Parent = parent
	return btn
end

local function makeTextboxRow(y, placeholder)
	local frame = makeRow(y)
	local box = Instance.new("TextBox")
	box.Size = UDim2.new(0.6, -5, 1, 0)
	box.Position = UDim2.new(0, 0, 0, 0)
	box.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	box.BorderSizePixel = 0
	box.Font = Enum.Font.Gotham
	box.TextSize = 14
	box.TextColor3 = Color3.new(1, 1, 1)
	box.PlaceholderText = placeholder
	box.Parent = frame

	local toggle = Instance.new("TextButton")
	toggle.Size = UDim2.new(0.4, -5, 1, 0)
	toggle.Position = UDim2.new(0.6, 5, 0, 0)
	toggle.BackgroundColor3 = Color3.fromRGB(58, 58, 58)
	toggle.BorderSizePixel = 0
	toggle.Font = Enum.Font.Gotham
	toggle.TextSize = 14
	toggle.TextColor3 = Color3.new(1, 1, 1)
	toggle.Text = "Loop: Off"
	toggle.Parent = frame

	return box, toggle
end

-- NPC Utilities
local function getNPCs()
	local npcs = {}
	for _, obj in ipairs(workspace:GetDescendants()) do
		if obj:IsA("Model") and not Players:GetPlayerFromCharacter(obj) then
			local hum = obj:FindFirstChildOfClass("Humanoid")
			local hasPart = obj:FindFirstChildWhichIsA("BasePart")
			if hum and hasPart then
				table.insert(npcs, obj)
			end
		end
	end
	return npcs
end

local function iterateBaseParts(npc, fn)
	for _, part in ipairs(npc:GetDescendants()) do
		if part:IsA("BasePart") then
			pcall(function() fn(part) end)
		end
	end
end

-- Actions
local function getRidNPC(npc)
	local targetPos = Vector3.new(9e37, 9e37, 9e37)
	iterateBaseParts(npc, function(p) p.CFrame = CFrame.new(targetPos) end)
	task.delay(0.2, function()
		iterateBaseParts(npc, function(p) p.Anchored = true end)
	end)
end

local function removeNPCTools(npc)
	for _, tool in ipairs(npc:GetChildren()) do
		if tool:IsA("Tool") then tool:Destroy() end
	end
end

local function spasmNPC(npc)
	local hum = npc:FindFirstChildOfClass("Humanoid")
	if hum then hum.PlatformStand = true end
	iterateBaseParts(npc, function(p)
		local rx, ry, rz = math.rad(math.random(-180, 180)), math.rad(math.random(-180, 180)), math.rad(math.random(-180, 180))
		p.CFrame = p.CFrame * CFrame.Angles(rx, ry, rz)
	end)
end

local function behendigheidKill(npc)
	local head = npc:FindFirstChild("Head")
	if head then
		for _, a in ipairs(head:GetChildren()) do
			if a:IsA("Attachment") then a:Destroy() end
		end
		head:Destroy()
	end
end

local function jumpNPC(npc)
	local hum = npc:FindFirstChildOfClass("Humanoid")
	if hum then hum.Jump = true end
end

local function setHipHeight(npc, value)
	local hum = npc:FindFirstChildOfClass("Humanoid")
	if hum then hum.HipHeight = value end
end

-- Erase functions
local function eraseNPC(npc)
	local hum = npc:FindFirstChildOfClass("Humanoid")
	if hum then
		pcall(function() hum.Health = 0 end)
	end
	task.wait(0.1)
	pcall(function() npc:Destroy() end)
end

local function permanentEraseNPC(npc)
	pcall(function() npc:Destroy() end)
end

local function voidV2(npc)
	local targetPos = Vector3.new(1000000, 0, 1000000)
	local hrp = npc:FindFirstChild("HumanoidRootPart") or npc:FindFirstChildWhichIsA("BasePart")
	if hrp then
		pcall(function() hrp.CFrame = CFrame.new(targetPos) end)
	end
end

-- GUI Layout
local y = 6
local EraseRow = makeRow(y) y = y + 40
local PermEraseRow = makeRow(y) y = y + 40
local VoidRow = makeRow(y) y = y + 40
local GetRidRow = makeRow(y) y = y + 40
local RemoveToolsRow = makeRow(y) y = y + 40
local SpasmRow = makeRow(y) y = y + 40
local BehendigheidRow = makeRow(y) y = y + 40
local JumpRow = makeRow(y) y = y + 40
local HipHeightBox, HipHeightToggle = makeTextboxRow(y, "HipHeight Value") y = y + 40

-- Buttons
local EraseBtn = makeToggle(EraseRow, "Erase NPCs from Existence")
local PermEraseBtn = makeToggle(PermEraseRow, "Permanent Erase NPCs")
local VoidBtn = makeToggle(VoidRow, "Void v2 NPCs")
local GetRidBtn = makeToggle(GetRidRow, "Get Rid of NPCs")
local RemoveToolsBtn = makeToggle(RemoveToolsRow, "Remove NPC Tools")
local SpasmBtn = makeToggle(SpasmRow, "Spasm NPCs")
local KillBehendigheidBtn = makeToggle(BehendigheidRow, "Kill (Behendigheid)")

local JumpBtn = Instance.new("TextButton")
JumpBtn.Size = UDim2.new(0.6, -5, 1, 0)
JumpBtn.BackgroundColor3 = Color3.fromRGB(58, 58, 58)
JumpBtn.BorderSizePixel = 0
JumpBtn.Font = Enum.Font.Gotham
JumpBtn.TextSize = 14
JumpBtn.TextColor3 = Color3.new(1, 1, 1)
JumpBtn.Text = "Jump NPCs"
JumpBtn.Parent = JumpRow

local JumpLoop = Instance.new("TextButton")
JumpLoop.Size = UDim2.new(0.4, -5, 1, 0)
JumpLoop.Position = UDim2.new(0.6, 5, 0, 0)
JumpLoop.BackgroundColor3 = Color3.fromRGB(58, 58, 58)
JumpLoop.BorderSizePixel = 0
JumpLoop.Font = Enum.Font.Gotham
JumpLoop.TextSize = 14
JumpLoop.TextColor3 = Color3.new(1, 1, 1)
JumpLoop.Text = "Loop: Off"
JumpLoop.Parent = JumpRow

-- Loop system
local function startLoop(flagName, action, extra)
	coroutine.wrap(function()
		while _G[flagName] do
			for _, npc in ipairs(getNPCs()) do
				pcall(function() action(npc, extra) end)
			end
			task.wait(LOOP_DELAY)
		end
	end)()
end

local function toggleLoop(btn, flagName, action)
	_G[flagName] = not _G[flagName]
	btn.Text = btn.Text:match(": Off") and btn.Text:gsub("Off", "On") or btn.Text:gsub("On", "Off")
	if _G[flagName] then startLoop(flagName, action) end
end

-- Bindings
EraseBtn.MouseButton1Click:Connect(function() toggleLoop(EraseBtn, "eraseLoop", eraseNPC) end)
PermEraseBtn.MouseButton1Click:Connect(function() toggleLoop(PermEraseBtn, "permEraseLoop", permanentEraseNPC) end)
VoidBtn.MouseButton1Click:Connect(function() toggleLoop(VoidBtn, "voidLoop", voidV2) end)
GetRidBtn.MouseButton1Click:Connect(function() toggleLoop(GetRidBtn, "getRidLoop", getRidNPC) end)
RemoveToolsBtn.MouseButton1Click:Connect(function() toggleLoop(RemoveToolsBtn, "removeToolsLoop", removeNPCTools) end)
SpasmBtn.MouseButton1Click:Connect(function() toggleLoop(SpasmBtn, "spasmLoop", spasmNPC) end)
KillBehendigheidBtn.MouseButton1Click:Connect(function() toggleLoop(KillBehendigheidBtn, "behendigheidLoop", behendigheidKill) end)
JumpBtn.MouseButton1Click:Connect(function()
	for _, npc in ipairs(getNPCs()) do pcall(function() jumpNPC(npc) end) end
end)
JumpLoop.MouseButton1Click:Connect(function()
	_G["jumpLoop"] = not _G["jumpLoop"]
	JumpLoop.Text = "Loop: " .. (_G["jumpLoop"] and "On" or "Off")
	if _G["jumpLoop"] then startLoop("jumpLoop", jumpNPC) end
end)
HipHeightToggle.MouseButton1Click:Connect(function()
	local val = tonumber(HipHeightBox.Text) or 2
	_G["hipLoop"] = not _G["hipLoop"]
	HipHeightToggle.Text = "Loop: " .. (_G["hipLoop"] and "On" or "Off")
	if _G["hipLoop"] then startLoop("hipLoop", setHipHeight, val) end
end)

-- GUI Toggle
local open = false
ToggleButton.MouseButton1Click:Connect(function()
	open = not open
	local targetSize = open and UDim2.new(0, GUI_WIDTH, 0, GUI_HEIGHT) or UDim2.new(0, GUI_WIDTH, 0, 34)
	TweenService:Create(MainFrame, TweenInfo.new(0.22, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {Size = targetSize}):Play()
	task.wait(0.08)
	Options.Visible = open
end)

print("[NPCUtilityGUI v4.1] Loaded - Permanent Erase & Void v2 Active")
