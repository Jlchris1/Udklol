-- Skybox Asset Copier GUI (FINAL FIX)

local Players = game:GetService("Players")
local Lighting = game:GetService("Lighting")
local UIS = game:GetService("UserInputService")

local player = Players.LocalPlayer

local ORDER = {
	"SkyboxBk",
	"SkyboxDn",
	"SkyboxFt",
	"SkyboxLf",
	"SkyboxRt",
	"SkyboxUp"
}

-- Clipboard
local function copy(txt)
	if setclipboard then
		setclipboard(txt)
	end
end

-- Collect all Sky objects
local Skies = {}
for _, v in ipairs(Lighting:GetChildren()) do
	if v:IsA("Sky") then
		table.insert(Skies, v)
	end
end

if #Skies == 0 then
	warn("No Sky objects found")
	return
end

-- GUI
local gui = Instance.new("ScreenGui")
gui.Name = "SkyboxCopier"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

-- Toggle Button
local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.fromOffset(44, 44)
toggleBtn.Position = UDim2.fromScale(0.95, 0.05)
toggleBtn.AnchorPoint = Vector2.new(1, 0)
toggleBtn.Text = "☁"
toggleBtn.TextSize = 20
toggleBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
toggleBtn.TextColor3 = Color3.new(1, 1, 1)
toggleBtn.Parent = gui
Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(1, 0)

-- Main Frame (mobile sized)
local main = Instance.new("Frame")
main.Size = UDim2.fromOffset(360, 300)
main.Position = UDim2.fromScale(0.5, 0.55)
main.AnchorPoint = Vector2.new(0.5, 0.5)
main.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
main.Parent = gui
Instance.new("UICorner", main).CornerRadius = UDim.new(0, 12)

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.fromOffset(360, 36)
title.Text = "Skybox Copier"
title.Font = Enum.Font.GothamBold
title.TextSize = 14
title.TextColor3 = Color3.new(1, 1, 1)
title.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
title.Parent = main

-- Destroy Button
local destroyBtn = Instance.new("TextButton")
destroyBtn.Size = UDim2.fromOffset(32, 32)
destroyBtn.Position = UDim2.fromOffset(324, 2)
destroyBtn.Text = "✕"
destroyBtn.TextSize = 16
destroyBtn.BackgroundTransparency = 1
destroyBtn.TextColor3 = Color3.fromRGB(255, 100, 100)
destroyBtn.Parent = title

destroyBtn.MouseButton1Click:Connect(function()
	gui:Destroy()
end)

-- Tabs
local tabs = Instance.new("ScrollingFrame")
tabs.Position = UDim2.fromOffset(10, 42)
tabs.Size = UDim2.fromOffset(340, 32)
tabs.AutomaticCanvasSize = Enum.AutomaticSize.X
tabs.CanvasSize = UDim2.new()
tabs.ScrollBarImageTransparency = 1
tabs.Parent = main

local tabLayout = Instance.new("UIListLayout")
tabLayout.FillDirection = Enum.FillDirection.Horizontal
tabLayout.Padding = UDim.new(0, 6)
tabLayout.Parent = tabs

-- Content List
local scroll = Instance.new("ScrollingFrame")
scroll.Position = UDim2.fromOffset(10, 80)
scroll.Size = UDim2.fromOffset(340, 170)
scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
scroll.CanvasSize = UDim2.new()
scroll.ScrollBarImageTransparency = 0.4
scroll.Parent = main

local listLayout = Instance.new("UIListLayout")
listLayout.Padding = UDim.new(0, 6)
listLayout.Parent = scroll

-- Copy All Button
local copyAll = Instance.new("TextButton")
copyAll.Position = UDim2.fromOffset(10, 255)
copyAll.Size = UDim2.fromOffset(340, 34)
copyAll.Text = "Copy All"
copyAll.Font = Enum.Font.GothamBold
copyAll.TextSize = 13
copyAll.TextColor3 = Color3.new(1, 1, 1)
copyAll.BackgroundColor3 = Color3.fromRGB(70, 120, 255)
copyAll.Parent = main
Instance.new("UICorner", copyAll).CornerRadius = UDim.new(0, 8)

-- CURRENT DATA
local currentLines = {}

-- CLEAR CONTENT PROPERLY
local function clearList()
	for _, child in ipairs(scroll:GetChildren()) do
		if not child:IsA("UIListLayout") then
			child:Destroy()
		end
	end
	currentLines = {}
end

-- SHOW SKY
local function showSky(sky)
	clearList()

	for _, prop in ipairs(ORDER) do
		local line = prop .. " = " .. tostring(sky[prop])
		table.insert(currentLines, line)

		local row = Instance.new("Frame")
		row.Size = UDim2.fromOffset(340, 38)
		row.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
		row.Parent = scroll
		Instance.new("UICorner", row).CornerRadius = UDim.new(0, 6)

		local label = Instance.new("TextLabel")
		label.Position = UDim2.fromOffset(8, 0)
		label.Size = UDim2.fromOffset(220, 38)
		label.BackgroundTransparency = 1
		label.TextWrapped = true
		label.TextXAlignment = Enum.TextXAlignment.Left
		label.Text = line
		label.Font = Enum.Font.Gotham
		label.TextSize = 12
		label.TextColor3 = Color3.new(1, 1, 1)
		label.Parent = row

		local btn = Instance.new("TextButton")
		btn.Position = UDim2.fromOffset(240, 5)
		btn.Size = UDim2.fromOffset(90, 28)
		btn.Text = "Copy"
		btn.Font = Enum.Font.GothamBold
		btn.TextSize = 12
		btn.TextColor3 = Color3.new(1, 1, 1)
		btn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
		btn.Parent = row
		Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)

		btn.MouseButton1Click:Connect(function()
			copy(line)
		end)
	end
end

-- Copy All
copyAll.MouseButton1Click:Connect(function()
	copy(table.concat(currentLines, "\n"))
end)

-- Create Tabs
for i, sky in ipairs(Skies) do
	local tab = Instance.new("TextButton")
	tab.Size = UDim2.fromOffset(90, 28)
	tab.Text = sky.Name ~= "" and sky.Name or ("Sky " .. i)
	tab.Font = Enum.Font.GothamBold
	tab.TextSize = 12
	tab.TextColor3 = Color3.new(1, 1, 1)
	tab.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
	tab.Parent = tabs
	Instance.new("UICorner", tab).CornerRadius = UDim.new(0, 6)

	tab.MouseButton1Click:Connect(function()
		showSky(sky)
	end)
end

-- Default sky
showSky(Skies[1])

-- Toggle GUI
toggleBtn.MouseButton1Click:Connect(function()
	main.Visible = not main.Visible
end)
